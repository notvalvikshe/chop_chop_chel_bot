# ChopBot ‚Äî Telegram-–±–æ—Ç –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏ –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É

Telegram-–±–æ—Ç –Ω–∞ NestJS –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏ –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É —á–µ—Ä–µ–∑ YClients API.

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ —É—Å–ª—É–≥ –∏ —Ü–µ–Ω
- ‚úÖ –û–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å –Ω–∞ —É—Å–ª—É–≥—É —Å –≤—ã–±–æ—Ä–æ–º –º–∞—Å—Ç–µ—Ä–∞, –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–µ–ª–µ—Ñ–æ–Ω, email)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–ø–∏—Å–µ–π (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ YClients)
- üîú SMS-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ YClients (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- üîú –û—Ç–º–µ–Ω–∞ –∏ –ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–µ–π (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ VPS

**[üìã DEPLOY_CHECKLIST.md](./DEPLOY_CHECKLIST.md)** - –ù–∞—á–Ω–∏—Ç–µ –æ—Ç—Å—é–¥–∞! –ü–æ—à–∞–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ VPS —Å –∞–≤—Ç–æ–¥–µ–ø–ª–æ–µ–º —á–µ—Ä–µ–∑ GitHub Actions.

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã:

- [QUICK_START.md](./QUICK_START.md) - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [DEPLOY.md](./DEPLOY.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [FIRST_DEPLOY.md](./FIRST_DEPLOY.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞: [docs/architecture.md](docs/architecture.md)

- **Backend**: NestJS + TypeScript
- **Bot Framework**: Telegraf + nestjs-telegraf
- **Database**: PostgreSQL + Drizzle ORM
- **External API**: YClients REST API
- **Config**: Zod validation

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 20.11
- PostgreSQL >= 14
- npm –∏–ª–∏ pnpm

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone <repository-url>
cd chop_chop_chel_bot
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
npm install
# –∏–ª–∏
pnpm install
```

3. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:
   - `TELEGRAM_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞ (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
   - `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
   - `YCLIENTS_PARTNER_TOKEN` ‚Äî –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π —Ç–æ–∫–µ–Ω YClients API
   - `YCLIENTS_COMPANY_ID` ‚Äî ID –∫–æ–º–ø–∞–Ω–∏–∏ –≤ YClients
   - `YCLIENTS_BOOK_FORM_ID` ‚Äî ID —Ñ–æ—Ä–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è YClients

5. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è docker-compose):

```bash
docker-compose up -d
```

6. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
npm run db:push
```

## üöÄ –ó–∞–ø—É—Å–∫

### Development —Ä–µ–∂–∏–º

```bash
npm run start:dev
```

### Production —Ä–µ–∂–∏–º

```bash
npm run build
npm run start:prod
```

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ bot/           # Telegram-–±–æ—Ç (–∫–æ–º–∞–Ω–¥—ã, —Ö–µ–Ω–¥–ª–µ—Ä—ã, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã)
‚îÇ   ‚îú‚îÄ‚îÄ user/          # –î–æ–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–æ–¥–µ–ª—å, —Å–µ—Ä–≤–∏—Å, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
‚îÇ   ‚îî‚îÄ‚îÄ booking/       # –î–æ–º–µ–Ω –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–ø–∏—Å—è–º–∏)
‚îú‚îÄ‚îÄ yclients/          # YClients API –∫–ª–∏–µ–Ω—Ç (HTTP-—Å–µ—Ä–≤–∏—Å, —Ç–∏–ø—ã)
‚îú‚îÄ‚îÄ db/                # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å—Ö–µ–º–∞, —Å–µ—Ä–≤–∏—Å)
‚îú‚îÄ‚îÄ middleware/        # Middleware –¥–ª—è Telegraf (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îú‚îÄ‚îÄ app.module.ts      # –ö–æ—Ä–Ω–µ–≤–æ–π –º–æ–¥—É–ª—å
‚îú‚îÄ‚îÄ main.ts            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ env.validator.ts   # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (Zod)
```

## üìñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` ‚Äî –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/services` ‚Äî –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –∏ —Ü–µ–Ω (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏)
- `/book` ‚Äî –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- `/my_bookings` ‚Äî –ú–æ–∏ –∑–∞–ø–∏—Å–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ YClients)
- `/help` ‚Äî –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∏ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é:

- üíá –£—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã
- üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
- üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏
- ‚ÑπÔ∏è –ü–æ–º–æ—â—å

## üß™ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –ë–î

–¢–∞–±–ª–∏—Ü–∞ `users`:

- Telegram-–ø—Ä–æ—Ñ–∏–ª—å (id, –∏–º—è, –Ω–∏–∫)
- YClients-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (userToken, userId, phone)
- Whitelist –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

### Drizzle –∫–æ–º–∞–Ω–¥—ã

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–µ–º—ã
npm run db:generate

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
npm run db:migrate

# Push —Å—Ö–µ–º—ã –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î (–¥–ª—è dev)
npm run db:push
```

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](docs/architecture.md) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Å–ª–æ—ë–≤ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- [API Documentation](docs/apidoc.md) ‚Äî –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è YClients API
- [Copilot Instructions](copilot-instructions.md) ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ü—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. –°–ª–µ–¥–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –∏–∑ [docs/architecture.md](docs/architecture.md)
2. **–û–±–Ω–æ–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ API, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Nest Logger –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`new Logger(ClassName.name)`)
4. –†–∞–∑–¥–µ–ª—è—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø–æ –¥–æ–º–µ–Ω–Ω—ã–º –º–æ–¥—É–ª—è–º (user, booking –∏ —Ç.–¥.)
5. –†–∞–±–æ—Ç—É —Å –ë–î ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Drizzle ORM –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
6. Telegram-–∫–æ–º–∞–Ω–¥—ã ‚Äî –≤ `BotService`, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É ‚Äî –≤ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

## üåê YClients API

–ü—Ä–æ–µ–∫—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å YClients REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

- –£—Å–ª—É–≥–∞–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- –ú–∞—Å—Ç–µ—Ä–∞–º–∏ (–ø–µ—Ä—Å–æ–Ω–∞–ª)
- –ó–∞–ø–∏—Å—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä, –æ—Ç–º–µ–Ω–∞, –ø–µ—Ä–µ–Ω–æ—Å)
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ SMS

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API: [docs/apidoc.md](docs/apidoc.md)

## üìÑ –õ–∏—Ü–µ–Ω–∑–∞

UNLICENSED
